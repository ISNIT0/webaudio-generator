<html>

<body>
    <script>
        (async function () { // Top Level async/await

            const audioCtx = new(window.AudioContext || window.webkitAudioContext)();

            const audioFileRequest = new XMLHttpRequest();
            audioFileRequest.open('GET', "./br-jam-loop.wav", true);
            audioFileRequest.responseType = 'arraybuffer';

            const audioFilePromise = new Promise((resolve, reject) => {
                audioFileRequest.onload = function () {
                    audioCtx.decodeAudioData(audioFileRequest.response, resolve, reject);
                }
                audioFileRequest.onerror = reject;
            })
            audioFileRequest.send();

            const fileNode = audioCtx.createBufferSource();
            fileNode.buffer = await audioFilePromise;
            fileNode.start();


            const gainNode1 = audioCtx.createGain();
            gainNode1.gain.value = 0.4;


            const gainNode2 = audioCtx.createGain();
            gainNode2.gain.value = 1;


            const biquadFilterNode = audioCtx.createBiquadFilter();
            biquadFilterNode.gain.value = 0;
            biquadFilterNode.Q.value = 1;
            biquadFilterNode.detune.value = 0;
            biquadFilterNode.frequency.value = 1424;
            biquadFilterNode.type.value = "lowpass";


            const delayNode = audioCtx.createDelay();
            delayNode.delayTime.value = 1000;


            const speakerNode = audioCtx.destination;



            fileNode.connect(gainNode1);
            gainNode1.connect(gainNode2);
            gainNode2.connect(biquadFilterNode);
            biquadFilterNode.connect(delayNode);
            delayNode.connect(speakerNode);

        })();
    </script>
</body>

</html>